<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EEMTI DragÃ£o do Mar - OcorrÃªncias</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f0f2f5; margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px; text-align: center; box-sizing: border-box; }
        .logo-escola { max-width: 120px; height: auto; margin-bottom: 15px; }
        h2, h3 { color: #1a73e8; margin-bottom: 15px; font-size: 1.4rem; }
        label { font-weight: bold; display: block; margin-top: 12px; color: #444; text-align: left; font-size: 0.95rem; }
        select, input, textarea { width: 100%; padding: 14px; margin-top: 5px; border: 1px solid #ccd1d9; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        /* Estilo para as opÃ§Ãµes de Checkbox */
        .checkbox-group { text-align: left; background: #f9f9f9; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-top: 5px; }
        .checkbox-item { display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; font-size: 0.9rem; }
        .checkbox-item input { width: auto; margin-right: 10px; margin-top: 0; transform: scale(1.2); }

        button { width: 100%; padding: 16px; margin-top: 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        .btn-blue { background-color: #1a73e8; color: white; }
        .btn-green { background-color: #25d366; color: white; }
        button:active { transform: scale(0.98); }
        .info-aluno { background: #e7f3ff; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-weight: bold; color: #1a73e8; font-size: 1rem; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <img src="imagem1.png" alt="Logo da Escola" class="logo-escola" onerror="this.style.display='none';">

    <div id="tela-login">
        <h2>EEMTI DRAGÃƒO DO MAR <br> SISTEMA DE OCORRÃŠNCIAS</h2>
        <input type="password" id="senha" placeholder="Senha de acesso" inputmode="numeric">
        <button class="btn-blue" onclick="fazerLogin()">ENTRAR</button>
    </div>

    <div id="tela-selecao" class="hidden">
        <h2>Nova OcorrÃªncia</h2>
        <label>Modalidade:</label>
        <select id="modalidade" onchange="atualizarTurmas()">
            <option value="">Selecione...</option>
            <option value="integral">Integral</option>
            <option value="noturno">Noturno</option>
        </select>
        <label>Turma:</label>
        <select id="turma" onchange="atualizarAlunos()"><option value="">Aguardando modalidade...</option></select>
        <label>Aluno:</label>
        <select id="aluno"><option value="">Aguardando turma...</option></select>
        <button class="btn-blue" onclick="abrirFormulario()">CRIAR OCORRÃŠNCIA</button>
    </div>

    <div id="tela-formulario" class="hidden">
        <h3>Registro de Indisciplina</h3>
        <div class="info-aluno">Aluno(a): <span id="nome-aluno-confirmado"></span></div>

        <label>Tipo de OcorrÃªncia (Marque as opÃ§Ãµes):</label>
        <div class="checkbox-group" id="tipos-ocorrencia">
            <label class="checkbox-item"><input type="checkbox" value="NÃ£o usa o uniforme escolar"> NÃ£o usa o uniforme escolar</label>
            <label class="checkbox-item"><input type="checkbox" value="Tumultua a aula"> Tumultua a aula</label>
            <label class="checkbox-item"><input type="checkbox" value="Comporta-se de forma agressiva"> Comporta-se de forma agressiva</label>
            <label class="checkbox-item"><input type="checkbox" value="Chegou em sala atrasado(a)"> Chegou em sala atrasado(a)</label>
            <label class="checkbox-item"><input type="checkbox" value="NÃ£o segue as orientaÃ§Ãµes do professor"> NÃ£o segue as orientaÃ§Ãµes do professor</label>
            <label class="checkbox-item"><input type="checkbox" value="Depreda o patrimÃ´nio pÃºblico"> Depreda o patrimÃ´nio pÃºblico</label>
            <label class="checkbox-item"><input type="checkbox" value="Usa o celular de forma indevida"> Usa o celular de forma indevida</label>
            <label class="checkbox-item"><input type="checkbox" value="Desrespeita professores, colegas e/ou funcionÃ¡rios"> Desrespeita professores, colegas e/ou funcionÃ¡rios</label>
            <label class="checkbox-item"><input type="checkbox" value="Saiu de sala sem autorizaÃ§Ã£o"> Saiu de sala sem autorizaÃ§Ã£o</label>
            <label class="checkbox-item"><input type="checkbox" value="Saiu da escola sem autorizaÃ§Ã£o"> Saiu da escola sem autorizaÃ§Ã£o</label>
        </div>

        <label>ObservaÃ§Ãµes Adicionais:</label>
        <textarea id="descricao" rows="3" placeholder="Detalhes extras..."></textarea>

        <label>Houve AgressÃ£o?</label>
        <select id="houve-agressao">
            <option value="NÃ£o">NÃ£o</option>
            <option value="Sim (FÃ­sica)">Sim (FÃ­sica)</option>
            <option value="Sim (Verbal)">Sim (Verbal)</option>
        </select>

        <label>Penalidades/SanÃ§Ãµes:</label>
        <input type="text" id="penalidades" placeholder="Ex: SuspensÃ£o ou AdvertÃªncia">

        <label>WhatsApp do ResponsÃ¡vel:</label>
        <input type="number" id="whatsapp-fone" placeholder="Ex: 85999999999" inputmode="tel">

        <button class="btn-green" onclick="gerarEEnviar()">SALVAR E NOTIFICAR VIA WHATSAPP</button>
    </div>
</div>

<script>
    const { jsPDF } = window.jspdf;

    const dadosEscola = {
        integral: {
            "1Âª SÃ©rie A": ["Ana Silva", "Bruno Souza"],
            "1Âª SÃ©rie B": ["Carlos Edu", "Daniela Lima"],
            "1Âª SÃ©rie C": ["Erick M.", "Fernanda O."],
            "2Âª SÃ©rie A": ["Gabriel H.", "Helena R."],
            "2Âª SÃ©rie B": ["Igor X.", "Julia P."],
            "2Âª SÃ©rie C": ["Kevin S.", "Lana T."],
            "3Âª SÃ©rie A": ["Mario J.", "Nina V."],
            "3Âª SÃ©rie B": ["OtÃ¡vio B.", "Paula C."]
        },
        noturno: {
            "1Âª SÃ©rie D": ["Ricardo F.", "Sonia G."],
            "2Âª SÃ©rie D": ["Tiago L.", "Ursula K."],
            "3Âª SÃ©rie C": ["Vitor Y.", "Zeca J."]
        }
    };

    function fazerLogin() {
        if(document.getElementById('senha').value === "23068086") {
            document.getElementById('tela-login').classList.add('hidden');
            document.getElementById('tela-selecao').classList.remove('hidden');
        } else { alert("Senha incorreta!"); }
    }

    function atualizarTurmas() {
        const mod = document.getElementById('modalidade').value;
        const sel = document.getElementById('turma');
        sel.innerHTML = '<option value="">Selecione a turma...</option>';
        if(mod && dadosEscola[mod]) {
            Object.keys(dadosEscola[mod]).forEach(t => sel.innerHTML += `<option value="${t}">${t}</option>`);
        }
    }

    function atualizarAlunos() {
        const mod = document.getElementById('modalidade').value;
        const tur = document.getElementById('turma').value;
        const sel = document.getElementById('aluno');
        sel.innerHTML = '<option value="">Selecione o aluno...</option>';
        if(mod && tur && dadosEscola[mod][tur]) {
            dadosEscola[mod][tur].forEach(a => sel.innerHTML += `<option value="${a}">${a}</option>`);
        }
    }

    function abrirFormulario() {
        const alunoSel = document.getElementById('aluno').value;
        if(!alunoSel) return alert("Selecione um aluno!");
        document.getElementById('nome-aluno-confirmado').innerText = alunoSel;
        document.getElementById('tela-selecao').classList.add('hidden');
        document.getElementById('tela-formulario').classList.remove('hidden');
        window.scrollTo(0,0);
    }

    function gerarEEnviar() {
        const aluno = document.getElementById('nome-aluno-confirmado').innerText;
        const turma = document.getElementById('turma').value;
        const obsAdicional = document.getElementById('descricao').value;
        const agr = document.getElementById('houve-agressao').value;
        const pen = document.getElementById('penalidades').value;
        const fone = document.getElementById('whatsapp-fone').value;

        // Pegar todos os tipos marcados
        const checkboxes = document.querySelectorAll('#tipos-ocorrencia input[type="checkbox"]:checked');
        let tiposSelecionados = Array.from(checkboxes).map(cb => cb.value);
        
        if(tiposSelecionados.length === 0 && obsAdicional === "") {
            return alert("Por favor, selecione ao menos um tipo de ocorrÃªncia ou escreva uma observaÃ§Ã£o.");
        }
        if(!fone) return alert("Preencha o WhatsApp!");

        const agora = new Date();
        const dataFormatada = agora.toLocaleDateString('pt-BR');
        const horaFormatada = agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

        const textoTipos = tiposSelecionados.join(', ');

        // 1. GERAR PDF
        const doc = new jsPDF();
        doc.setFontSize(14);
        doc.text("EEMTI DRAGÃƒO DO MAR", 105, 15, { align: "center" });
        doc.setFontSize(11);
        doc.text("RELATÃ“RIO DE OCORRÃŠNCIA ESCOLAR", 105, 22, { align: "center" });
        
        doc.setFontSize(10);
        doc.text(`Data: ${dataFormatada} Ã s ${horaFormatada}`, 20, 35);
        doc.text(`Aluno(a): ${aluno}`, 20, 42);
        doc.text(`Turma: ${turma}`, 20, 49);
        doc.line(20, 52, 190, 52);

        doc.setFont("helvetica", "bold");
        doc.text("TIPOS DE OCORRÃŠNCIA:", 20, 60);
        doc.setFont("helvetica", "normal");
        doc.text(textoTipos || "Conforme observaÃ§Ãµes abaixo", 20, 65, { maxWidth: 170 });

        doc.setFont("helvetica", "bold");
        doc.text("OBSERVAÃ‡Ã•ES ADICIONAIS:", 20, 85);
        doc.setFont("helvetica", "normal");
        doc.text(obsAdicional || "Nenhuma", 20, 90, { maxWidth: 170 });

        doc.text(`Houve Algum Tipo de AgressÃ£o ? ${agr}`, 20, 115);
        doc.text(`SanÃ§Ãµes: ${pen}`, 20, 125);
        
        doc.save(`Ocorrencia_${aluno.split(' ')[0]}.pdf`);

        // 2. WHATSAPP
        const saudacao = `*ðŸ“ŽCOMUNICADO ESCOLAR*%0A%0AðŸ“ŒOlÃ¡, somos da escola *EEMTI DRAGÃƒO DO MAR*. Informamos que um relatÃ³rio de indisciplina foi gerado para o(a) aluno(a) *${aluno}* em *${dataFormatada}* Ã s *${horaFormatada}*.%0A%0A`;
        const detalhes = `*âž¡ï¸DETALHES:*%0A%0A` +
                         `*ðŸŽ“Aluno(a):* ${aluno}%0A` +
                         `*ðŸ“†Data:* ${dataFormatada} - ${horaFormatada}%0A` +
                         `*âš ï¸OcorrÃªncia(s):*%0A ${textoTipos || "Ver observaÃ§Ãµes"}%0A` +
                         `*ðŸ“ObservaÃ§Ãµes:* %0A ${obsAdicional || "NÃ£o informada"}%0A` +
                         `*âš ï¸Houve algum tipo de agressÃ£o?* ${agr}%0A` +
                         `*ðŸš¦SanÃ§Ãµes:* ${pen}%0A%0A` +
                         `_ðŸ’¾O arquivo PDF detalhado foi gerado e salvo. Por favor, solicite-o caso necessÃ¡rio ou aguarde o envio manual por este canal._`;

        const url = `https://api.whatsapp.com/send?phone=55${fone}&text=${saudacao}${detalhes}`;
        setTimeout(() => { window.open(url, '_blank'); }, 1000);
    }
</script>
</body>
</html>






